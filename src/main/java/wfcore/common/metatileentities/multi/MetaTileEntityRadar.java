package wfcore.common.metatileentities.multi;

import codechicken.lib.render.CCRenderState;
import codechicken.lib.render.pipeline.IVertexOperation;
import codechicken.lib.vec.Matrix4;
import com.cleanroommc.modularui.factory.PosGuiData;
import com.cleanroommc.modularui.screen.ModularPanel;
import com.cleanroommc.modularui.value.sync.PanelSyncManager;
import com.google.common.collect.Lists;
import gregtech.api.GTValues;
import gregtech.api.capability.IControllable;
import gregtech.api.capability.IEnergyContainer;
import gregtech.api.capability.IOpticalComputationProvider;
import gregtech.api.capability.impl.EnergyContainerList;
import gregtech.api.metatileentity.IDataInfoProvider;
import gregtech.api.metatileentity.MetaTileEntity;
import gregtech.api.metatileentity.interfaces.IGregTechTileEntity;
import gregtech.api.metatileentity.multiblock.IMultiblockPart;
import gregtech.api.metatileentity.multiblock.MultiblockAbility;
import gregtech.api.metatileentity.multiblock.MultiblockWithDisplayBase;
import gregtech.api.pattern.BlockPattern;
import gregtech.api.pattern.FactoryBlockPattern;
import gregtech.api.pattern.PatternMatchContext;
import gregtech.api.util.GTUtility;
import gregtech.client.renderer.ICubeRenderer;
import gregtech.client.renderer.texture.Textures;
import gregtech.common.blocks.BlockMetalCasing;
import gregtech.common.blocks.MetaBlocks;
import net.minecraft.client.resources.I18n;
import net.minecraft.item.ItemStack;
import net.minecraft.nbt.NBTTagCompound;
import net.minecraft.util.ResourceLocation;
import net.minecraft.util.text.ITextComponent;
import net.minecraft.world.World;
import net.minecraftforge.fml.relauncher.Side;
import net.minecraftforge.fml.relauncher.SideOnly;
import org.jetbrains.annotations.NotNull;
import org.jetbrains.annotations.Nullable;
import wfcore.api.capability.MultiblockRadarLogic;

import java.util.Arrays;
import java.util.List;

public class MetaTileEntityRadar extends MultiblockWithDisplayBase implements  IControllable, IDataInfoProvider {
    private IEnergyContainer energyContainer;
    private IOpticalComputationProvider computationProvider;
    private int minPts = 15;
    private int eps = 10;
    private int tier;
    //TODO: implement logic
    private final MultiblockRadarLogic radarLogic = new MultiblockRadarLogic(1, 1,1,this);



    public MetaTileEntityRadar(ResourceLocation metaTileEntityId) {
        super(metaTileEntityId);
    }

    public boolean isActive() {
        return isStructureFormed();
    }


   /* RADAR cannot have any blocks surrounding its dish, it should raycast about 100 blocks from in each direction
        y of the TE must be above sea level (may be removed though, ppl will cope about its size already)
        to ensure its surroundings are clean. It takes EV+ power (2 amps)
        it must have a GT cwp provided and have a dataslot, or be connected to data bank
        UI must allow for adjustment of minPts and eps (defaults are set already)
    */

    @Override
    protected void updateFormedValid() {

    }

    @Override
    public void addInformation(ItemStack stack, @Nullable World player, @NotNull List<String> tooltip,
                               boolean advanced) {
        tooltip.add(I18n.format("wfcore.machine.radar.tooltip"));
        tooltip.add(I18n.format("gregtech.universal.tooltip.energy_tier_range", GTValues.VNF[this.tier],
                GTValues.VNF[this.tier + 1]));
    }

    public void addToolUsages(ItemStack stack, @Nullable World world, List<String> tooltip, boolean advanced) {
        tooltip.add(I18n.format("gregtech.tool_action.screwdriver.toggle_mode_covers"));
        tooltip.add(I18n.format("gregtech.tool_action.wrench.set_facing"));
        if (getSound() != null) {
            tooltip.add(I18n.format("gregtech.tool_action.hammer"));
        }
        tooltip.add(I18n.format("gregtech.tool_action.crowbar"));
    }

    private void initializeAbilities() {
        this.energyContainer = new EnergyContainerList(getAbilities(MultiblockAbility.INPUT_ENERGY));
        //this.radarLogic.setVoltageTier(GTUtility.getTierByVoltage(this.energyContainer.getInputVoltage()));
        //this.radarLogic.setOverclockAmount(
        //        Math.max(1, GTUtility.getTierByVoltage(this.energyContainer.getInputVoltage()) - this.tier));
    }

    public boolean drainEnergy(boolean simulate) {
        long energyToDrain = GTValues.VA[getEnergyTier()];
        long resultEnergy = energyContainer.getEnergyStored() - energyToDrain;
        if (resultEnergy >= 0L && resultEnergy <= energyContainer.getEnergyCapacity()) {
            if (!simulate)
                energyContainer.changeEnergy(-energyToDrain);
            return true;
        }
        return false;
    }
    public int getEnergyTier() {
        if (energyContainer == null) return this.tier;
        return Math.min(this.tier + 1,
                Math.max(this.tier, GTUtility.getFloorTierByVoltage(energyContainer.getInputVoltage())));
    }



    //FIXME: wrong block IDs in some places (also may be too big, but thats for later to fix)
    protected @NotNull BlockPattern createStructurePattern() {

        /*return FactoryBlockPattern.start(RIGHT, FRONT, UP)
                .aisle("################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "#######################AAA######", "######################BBBBB#####", "#####################ABBBBBA####", "#####################SBBBBBA####", "#####################ABBBBBA####", "######################BBBBB#####", "#######################AAA######", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################")
                .aisle("################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "#######################C#C######", "######################C###C#####", "######################BD########", "######################C###C#####", "#######################C#C######", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################")
                .aisle("################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "#######################C#C######", "######################C###C#####", "######################BD########", "######################C###C#####", "#######################C#C######", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################")
                .aisle("################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "#######################C#C######", "######################C###C#####", "######################BD########", "######################C###C#####", "#######################C#C######", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################")
                .aisle("################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "#######################CBC######", "######################CBBBC#####", "######################BD#BB#####", "######################CBBBC#####", "#######################CBC######", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################")
                .aisle("################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "#######################CBC######", "######################CBBBC#####", "######################BD#BB#####", "######################CBBBC#####", "#######################CBC######", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################")
                .aisle("################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "#######################CBC######", "######################CBBBC#####", "######################BD#BB#####", "######################CBBBC#####", "#######################CBC######", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################")
                .aisle("################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "#####################DDCBC######", "######################CBBBC#####", "######################BD#BB#####", "######################CBBBC#####", "#####################DDCBC######", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################")
                .aisle("################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "####################DD#CBC######", "######################CBBBC#####", "######################BD#BB#####", "######################CBBBC#####", "####################DD#CBC######", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################")
                .aisle("################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "###################DD##CBC######", "######################CBBBC#####", "######################BD#BB#####", "######################CBBBC#####", "###################DD##CBC######", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################")
                .aisle("################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "###################D###CBC######", "##################D###CBBBC#####", "#################D####BD#BB#####", "##################D###CBBBC#####", "###################D###CBC######", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################")
                .aisle("################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "#####################DDDDDDD####", "#####################DDDDDDDD###", "###################BBBBCBCDDD###", "##################BBBBCBBBCDD###", "#################BBBBBBD#BBDD###", "##################BBBBCBBBCDD###", "###################BBBBCBCDDD###", "#####################DDDDDDDD###", "#####################DDDDDDD####", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################")
                .aisle("################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "#####################FFFFFFF####", "#####################F#####FF###", "###################BBBBC#C##F###", "##################A###C###C#F###", "#################A##########F###", "##################A###C###C#F###", "###################BBBBC#C##F###", "#####################F#####FF###", "#####################FFFFFFF####", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################")
                .aisle("################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "###################GGGBC#C######", "##################G###C###C#####", "#################G##############", "##################G###C###C#####", "###################GGGBC#C######", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################")
                .aisle("################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "###################BBBBHHH######", "##################B###H###H#####", "#################B####H###III###", "##################B###H###H#####", "###################BBBBHHH######", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################")
                .aisle("################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "#######################HHH######", "###################BBB#HHH#J####", "##################BBBB#HAHIJII##", "###################BBB#HHH#J####", "#######################HHH######", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################")
                .aisle("################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "####################D###########", "#######################HHH######", "##########################JJJ###", "##########################JJJI##", "##########################JJJ###", "#######################HHH######", "####################D###########", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################")
                .aisle("################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "###################DHD##########", "####################D##HHH######", "####################D####JJJ####", "####################D####JJJII##", "####################D####JJJ####", "####################D##HHH######", "###################DHD##########", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################")
                .aisle("################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "##########JJJJJJJ###DHD#########", "##########JJJJJJJDDDDDD#H#######", "##########JJJJJJJ#####D#JJJ#####", "##########JJJJJJJ#####D#JJJ#####", "##########JJJJJJJ#####D#JJJ#####", "##########JJJJJJJDDDDDD#H#######", "##########JJJJJJJ###DHD#########", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################")
                .aisle("################################", "################################", "################################", "################################", "################################", "################################", "##########JJJJJJJ###############", "##########JJJJJJJ###############", "##########JJJJJJJ###############", "#######JJJ#######JJJ#DHD########", "#######JJJ#######JJJDDDDH#######", "#######JJJ#######JJJ#DDJJJ######", "#######JJJ######DJJJ#DDJJJ######", "#######JJJ#######JJJ#DDJJJ######", "#######JJJ#######JJJDDDDH#######", "#######JJJ#######JJJ#DHD########", "##########JJJJJJJ###############", "##########JJJJJJJ###############", "##########JJJJJJJ###############", "################################", "################################", "################################", "################################", "################################", "################################", "################################")
                .aisle("################################", "################################", "################################", "################################", "##########JJJJJJJ###############", "##########JJJJJJJ###############", "#######JJJ#######JJJ############", "#######JJJ#######JJJ############", "#######JJJ#######JJJ############", "#####KJ#############JJDHD#######", "#####KJ#############JJDDH#######", "#####KJ#############JJJJD#######", "#####KJ########DD###JJJJD#######", "#####KJ#############JJJJD#######", "#####KJ#############JJDDH#######", "#####KJ#############JJDHD#######", "#######JJJ#######JJJ############", "#######JJJ#######JJJ############", "#######JJJ#######JJJ############", "##########JJJJJJJ###############", "##########JJJJJJJ###############", "################################", "################################", "################################", "################################", "################################")
                .aisle("################################", "################################", "################################", "##########JJJJJJJ###############", "#######KJJ#######JJJ############", "#######KJJ#######JJJ############", "######K#############JJ##########", "######K#############JJ##########", "######K#############JJ##########", "######################JDHD######", "######################JDHD######", "######################JDHD######", "###############D######JDHD######", "######################JDHD######", "######################JDHD######", "######################JDHD######", "######K#############JJ##########", "######K#############JJ##########", "######K#############JJ##########", "#######KJJ#######JJJ############", "#######KJJ#######JJJ############", "##########JJJJJJJ###############", "################################", "################################", "################################", "################################")
                .aisle("################################", "################################", "##########JJJJJJJ###############", "#######KJJ#######JJJ############", "####################JJ##########", "####################JJ##########", "######################J#########", "######################J#########", "######################J#########", "#######################JDHD#####", "#######################JHD######", "#######################JD#######", "##############DD#######JD#######", "#######################JD#######", "#######################JHD######", "#######################JDHD#####", "######################J#########", "######################J#########", "######################J#########", "####################JJ##########", "####################JJ##########", "#######KJJ#######JJJ############", "##########JJJJJJJ###############", "################################", "################################", "################################")
                .aisle("################################", "################################", "##########JJJJJJJ###############", "########KJ#######JJJ############", "####################JJ##########", "#####################J##########", "######################J#########", "######################J#########", "######################J#########", "#######################J#DHD####", "#######################JDDD#####", "#######################J##D#####", "##############D########J##D#####", "#######################J##D#####", "#######################JDDD#####", "#######################J#DHD####", "######################J#########", "######################J#########", "######################J#########", "#####################J##########", "####################JJ##########", "########KJ#######JJJ############", "##########JJJJJJJ###############", "################################", "################################", "################################")
                .aisle("################################", "##########JJJJJJJ###############", "#########K#######JJJ############", "####################JJ##########", "######################J#########", "######################J#########", "#######################J########", "#######################J########", "#######################J########", "########################J#D#####", "########################JD######", "########################J#######", "#############DD#########J#######", "########################J#######", "########################JD######", "########################J#D#####", "#######################J########", "#######################J########", "#######################J########", "######################J#########", "######################J#########", "####################JJ##########", "#########K#######JJJ############", "##########JJJJJJJ###############", "################################", "################################")
                .aisle("################################", "##########KJJJJJJ###############", "#################JJJ############", "####################JJ##########", "######################J#########", "######################J#########", "#######################J########", "#######################J########", "#######################J########", "########################J#######", "########################JD######", "########################J#######", "#############D##########J#######", "########################J#######", "########################JD######", "########################J#######", "#######################J########", "#######################J########", "#######################J########", "######################J#########", "######################J#########", "####################JJ##########", "#################JJJ############", "##########KJJJJJJ###############", "################################", "################################")
                .aisle("################################", "###########KJJJJJ###############", "#################JJJ############", "####################JJ##########", "######################J#########", "######################J#########", "#######################J########", "#######################J########", "#######################J########", "########################J#######", "########################JD######", "########################J#######", "############DD##########J#######", "########################J#######", "########################JD######", "########################J#######", "#######################J########", "#######################J########", "#######################J########", "######################J#########", "######################J#########", "####################JJ##########", "#################JJJ############", "###########KJJJJJ###############", "################################", "################################")
                .aisle("############KJJJJ###############", "#################JJJ############", "####################JJ##########", "######################J#########", "#######################J########", "#######################J########", "########################J#######", "########################J#######", "########################J#######", "#########################J######", "#########################J######", "#########################J######", "############D##########DDJ######", "#########################J######", "#########################J######", "#########################J######", "########################J#######", "########################J#######", "########################J#######", "#######################J########", "#######################J########", "######################J#########", "####################JJ##########", "#################JJJ############", "############KJJJJ###############", "################################")
                .aisle("#############KJJJ###############", "#################JJJ############", "####################JJ##########", "######################J#########", "#######################J########", "#######################J########", "########################J#######", "########################J#######", "########################J#######", "#########################J######", "#########################J######", "#########################J######", "###########DD########DDD#J######", "#########################J######", "#########################J######", "#########################J######", "########################J#######", "########################J#######", "########################J#######", "#######################J########", "#######################J########", "######################J#########", "####################JJ##########", "#################JJJ############", "#############KJJJ###############", "################################")
                .aisle("##############KJJ###############", "#################JJJ############", "####################JJ##########", "######################J#########", "#######################J########", "#######################J########", "########################J#######", "########################J#######", "########################J#######", "#########################J######", "#########################J######", "#########################J######", "###########D#######DDD###J######", "#########################J######", "#########################J######", "#########################J######", "########################J#######", "########################J#######", "########################J#######", "#######################J########", "#######################J########", "######################J#########", "####################JJ##########", "#################JJJ############", "##############KJJ###############", "################################")
                .aisle("###############KJ###############", "#################JJJ############", "####################JJ##########", "######################J#########", "#######################J########", "#######################J########", "########################J#######", "########################J#######", "########################J#######", "#########################J######", "#########################J######", "#########################J######", "##########DD#####DDD#####J######", "#########################J######", "#########################J######", "#########################J######", "########################J#######", "########################J#######", "########################J#######", "#######################J########", "#######################J########", "######################J#########", "####################JJ##########", "#################JJJ############", "###############KJ###############", "################################")
                .aisle("################K###############", "#################JJJ############", "####################JJ##########", "######################J#########", "#######################J########", "#######################J########", "########################J#######", "########################J#######", "########################J#######", "#########################J######", "#########################J######", "#########################J######", "##########D####DDD#######J######", "#########################J######", "#########################J######", "#########################J######", "########################J#######", "########################J#######", "########################J#######", "#######################J########", "#######################J########", "######################J#########", "####################JJ##########", "#################JJJ############", "################K###############", "################################")
                .aisle("################################", "#################KJJ############", "####################JJ##########", "######################J#########", "#######################J########", "#######################J########", "########################J#######", "########################J#######", "########################J#######", "#########################J######", "#########################J######", "##########K##############J######", "#########KKK#DDD#########J######", "##########K##############J######", "#########################J######", "#########################J######", "########################J#######", "########################J#######", "########################J#######", "#######################J########", "#######################J########", "######################J#########", "####################JJ##########", "#################KJJ############", "################################", "################################")
                .aisle("################################", "##################KJ############", "####################JJ##########", "######################J#########", "#######################J########", "#######################J########", "########################J#######", "########################J#######", "########################J#######", "#########################J######", "#########################J######", "#########KKK#############J######", "#########KKKDD###########J######", "#########KKK#############J######", "#########################J######", "#########################J######", "########################J#######", "########################J#######", "########################J#######", "#######################J########", "#######################J########", "######################J#########", "####################JJ##########", "##################KJ############", "################################", "################################")
                .aisle("################################", "################################", "###################K############", "####################JJ##########", "######################J#########", "######################J#########", "#######################J########", "#######################J########", "#######################J########", "########################J#######", "########################J#######", "##########K#############J#######", "#########KKK############J#######", "##########K#############J#######", "########################J#######", "########################J#######", "#######################J########", "#######################J########", "#######################J########", "######################J#########", "######################J#########", "####################JJ##########", "###################K############", "################################", "################################", "################################")
                .aisle("################################", "################################", "################################", "####################KJ##########", "######################J#########", "######################J#########", "#######################J########", "#######################J########", "#######################J########", "########################J#######", "########################J#######", "########################J#######", "########################J#######", "########################J#######", "########################J#######", "########################J#######", "#######################J########", "#######################J########", "#######################J########", "######################J#########", "######################J#########", "####################KJ##########", "################################", "################################", "################################", "################################")
                .aisle("################################", "################################", "################################", "#####################K##########", "######################K#########", "######################K#########", "#######################J########", "#######################J########", "#######################J########", "########################J#######", "########################J#######", "########################J#######", "########################J#######", "########################J#######", "########################J#######", "########################J#######", "#######################J########", "#######################J########", "#######################J########", "######################K#########", "######################K#########", "#####################K##########", "################################", "################################", "################################", "################################")
                .aisle("################################", "################################", "################################", "################################", "################################", "################################", "######################K#########", "######################K#########", "######################K#########", "#######################J########", "#######################J########", "#######################J########", "#######################J########", "#######################J########", "#######################J########", "#######################J########", "######################K#########", "######################K#########", "######################K#########", "################################", "################################", "################################", "################################", "################################", "################################", "################################")
                .aisle("################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "#######################K########", "#######################K########", "#######################K########", "#######################K########", "#######################K########", "#######################K########", "#######################K########", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################", "################################")
                .where('#', any())
                .where('A', blocks(Blocks.BRICK_BLOCK))
                .where('B', states(MetaBlocks.STONE_BLOCKS.get(StoneVariantBlock.StoneVariant.SMOOTH).getState(StoneVariantBlock.StoneType.CONCRETE_DARK)))
                .where('C', states(MetaBlocks.STONE_BLOCKS.get(StoneVariantBlock.StoneVariant.SMOOTH).getState(StoneVariantBlock.StoneType.CONCRETE_LIGHT)))
                .where('D', frames(Materials.StainlessSteel))
                .where('F', blocks(Blocks.PLANKS))
                .where('G', blocks(MetaBlocks.COMPRESSED.get(Materials.StainlessSteel)))
                .where('H', states(MetaBlocks.METAL_CASING.getState(BlockMetalCasing.MetalCasingType.STEEL_SOLID)))
                .where('I', blocks(Blocks.GLASS))
                .where('J', states(MetaBlocks.METAL_CASING.getState(BlockMetalCasing.MetalCasingType.STAINLESS_CLEAN)))
                .where('K', states(MetaBlocks.METAL_CASING.getState(BlockMetalCasing.MetalCasingType.ALUMINIUM_FROSTPROOF)))
                .where('S', selfPredicate())
                .build();*/
        return FactoryBlockPattern.start()
                .aisle("XXX", "XXX", "XXX")
                .aisle("XXX", "XXX", "XXX")
                .aisle("XXX", "XYX", "XXX")
                .where('X', states(MetaBlocks.METAL_CASING.getState(BlockMetalCasing.MetalCasingType.PRIMITIVE_BRICKS))
                        .or(abilities(MultiblockAbility.IMPORT_ITEMS))
                        .or(abilities(MultiblockAbility.EXPORT_ITEMS))
                        .or(abilities(MultiblockAbility.IMPORT_FLUIDS))
                        .or(abilities(MultiblockAbility.EXPORT_FLUIDS)))
                .where('#', air())
                .where('Y', selfPredicate())
                .build();
    }

    @Override
    public ICubeRenderer getBaseTexture(IMultiblockPart iMultiblockPart) {
        return Textures.SOLID_STEEL_CASING;
    }

    @Override
    public MetaTileEntity createMetaTileEntity(IGregTechTileEntity iGregTechTileEntity) {
        return new MetaTileEntityRadar(metaTileEntityId);
        //this.radarLogic.getSpeed();
    }

    public void invalidateStructure() {
        super.invalidateStructure();
        resetTileAbilities();
        //if (this.radarLogic.isActive())
        //    this.radarLogic.setActive(false);
    }

    @Override
    protected void formStructure(PatternMatchContext context) {
        super.formStructure(context);
        initializeAbilities();
    }

    private void resetTileAbilities() {
        this.energyContainer = new EnergyContainerList(Lists.newArrayList());
    }


    @Override
    public boolean isWorkingEnabled() {
        return false;
    }

    @Override
    public void setWorkingEnabled(boolean b) {

    }

    @Override
    public boolean hasMaintenanceMechanics() {
        return false;
    }

    public int addActivity(int x, int z, int level) { radarLogic.addChunkActivity(x, z, level); return level;}
    //debug function

    public int scanChunk(int x, int z) { return radarLogic.scanChunk(x, z);}


    //public ArrayList<IntCoord2> getPlayerCords() { return radarLogic.performPlayerScan(); }

    @SideOnly(Side.CLIENT)
    @Override
    public void renderMetaTileEntity(CCRenderState renderState, Matrix4 translation, IVertexOperation[] pipeline) {
        super.renderMetaTileEntity(renderState, translation, pipeline);
        //this.getFrontOverlay().renderOrientedState(renderState, translation, pipeline, getFrontFacing(),
        //        this.radarLogic.isWorking(), this.isWorkingEnabled());
    }

    /*
    @Override
    public NBTTagCompound writeToNBT(NBTTagCompound data) {
        super.writeToNBT(data);
        data.setTag("minPts", new NBTTagInt(minPts));
        data.setTag("eps", new NBTTagInt(eps));
        return this.radarLogic.writeToNBT(data);
    }*/

    @Override
    public void readFromNBT(NBTTagCompound data) {
        super.readFromNBT(data);
        //chunkMode = data.getInteger("chunkMode") != 0;
        //silkTouch = data.getInteger("silkTouch") != 0;
        //this.radarLogic.readFromNBT(data);
    }

    @Override
    protected boolean shouldShowVoidingModeButton() {
        return false;
    }

    @Override
    public boolean allowsExtendedFacing() {
        return false;
    }

    @Override
    public @NotNull List<ITextComponent> getDataInfo() {
        return Arrays.asList();
    }

    @Override
    public ModularPanel buildUI(PosGuiData data, PanelSyncManager syncManager) {
        return null;
    }
}
